import{c as K,r as u,j as e,G as Z,e as N,d as q,aA as X,b as D,O as _,U as k,W as L,aB as J,J as U,a0 as z,a1 as Q,a2 as E,a3 as V,a4 as ee,a6 as te,a7 as se,a8 as ae,a9 as ne,aa as ie,X as re,ab as le,ac as de,ad as ce,f as oe,a5 as me,ae as xe,B as ue,af as he,F as pe,al as fe,am as ge,an as je,ao as Ne,ap as ve,aq as be,ar as we,as as ye,at as De,au as Ce,av as ke,aw as Se,ax as Ae,E as _e,ay as Me,az as Te}from"./index-CiVVu7O9.js";import{c as Le,R as P,C as Ie,X as Ue,Y as Ee,T as Pe,L as $e}from"./CartesianChart-D4hrz6Uz.js";import Re from"./CreateAppointment-BlwAm6CD.js";import{n as Fe,h as $,t as S,a as ze,c as Be,m as B,j as O,e as Oe,f as He,i as We,B as Ye,d as Ge,P as Ke,b as Ze,C as qe}from"./isWithinInterval-bjAIgTlj.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],Je=K("log-out",Xe);function M(a,t,n){const[i,c]=Fe(n?.in,a,t);return+$(i)==+$(c)}function Qe(a,t){return+S(a)>+S(t)}function R(a,t,n){return ze(a,-t,n)}function T(a,t){const n=()=>Be(t?.in,NaN),c=st(a);let d;if(c.date){const o=at(c.date,2);d=nt(o.restDateString,o.year)}if(!d||isNaN(+d))return n();const x=+d;let l=0,p;if(c.time&&(l=it(c.time),isNaN(l)))return n();if(c.timezone){if(p=rt(c.timezone),isNaN(p))return n()}else{const o=new Date(x+l),f=S(0,t?.in);return f.setFullYear(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate()),f.setHours(o.getUTCHours(),o.getUTCMinutes(),o.getUTCSeconds(),o.getUTCMilliseconds()),f}return S(x+l+p,t?.in)}const C={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},Ve=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,et=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,tt=/^([+-])(\d{2})(?::?(\d{2}))?$/;function st(a){const t={},n=a.split(C.dateTimeDelimiter);let i;if(n.length>2)return t;if(/:/.test(n[0])?i=n[0]:(t.date=n[0],i=n[1],C.timeZoneDelimiter.test(t.date)&&(t.date=a.split(C.timeZoneDelimiter)[0],i=a.substr(t.date.length,a.length))),i){const c=C.timezone.exec(i);c?(t.time=i.replace(c[1],""),t.timezone=c[1]):t.time=i}return t}function at(a,t){const n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),i=a.match(n);if(!i)return{year:NaN,restDateString:""};const c=i[1]?parseInt(i[1]):null,d=i[2]?parseInt(i[2]):null;return{year:d===null?c:d*100,restDateString:a.slice((i[1]||i[2]).length)}}function nt(a,t){if(t===null)return new Date(NaN);const n=a.match(Ve);if(!n)return new Date(NaN);const i=!!n[4],c=y(n[1]),d=y(n[2])-1,x=y(n[3]),l=y(n[4]),p=y(n[5])-1;if(i)return mt(t,l,p)?lt(t,l,p):new Date(NaN);{const o=new Date(0);return!ct(t,d,x)||!ot(t,c)?new Date(NaN):(o.setUTCFullYear(t,d,Math.max(c,x)),o)}}function y(a){return a?parseInt(a):1}function it(a){const t=a.match(et);if(!t)return NaN;const n=A(t[1]),i=A(t[2]),c=A(t[3]);return xt(n,i,c)?n*B+i*O+c*1e3:NaN}function A(a){return a&&parseFloat(a.replace(",","."))||0}function rt(a){if(a==="Z")return 0;const t=a.match(tt);if(!t)return 0;const n=t[1]==="+"?-1:1,i=parseInt(t[2]),c=t[3]&&parseInt(t[3])||0;return ut(i,c)?n*(i*B+c*O):NaN}function lt(a,t,n){const i=new Date(0);i.setUTCFullYear(a,0,4);const c=i.getUTCDay()||7,d=(t-1)*7+n+1-c;return i.setUTCDate(i.getUTCDate()+d),i}const dt=[31,null,31,30,31,30,31,31,30,31,30,31];function H(a){return a%400===0||a%4===0&&a%100!==0}function ct(a,t,n){return t>=0&&t<=11&&n>=1&&n<=(dt[t]||(H(a)?29:28))}function ot(a,t){return t>=1&&t<=(H(a)?366:365)}function mt(a,t,n){return t>=1&&t<=53&&n>=0&&n<=6}function xt(a,t,n){return a===24?t===0&&n===0:n>=0&&n<60&&t>=0&&t<60&&a>=0&&a<25}function ut(a,t){return t>=0&&t<=59}const ht=({patients:a=[],onSelect:t,onClose:n})=>{const[i,c]=u.useState(""),d=u.useMemo(()=>{const l=i.trim().toLowerCase();return l?a.filter(p=>(p.fullName||p.name||"").toLowerCase().includes(l)||(p.cardId||p.medicalId||"").toLowerCase().includes(l)):a},[i,a]),x=l=>l.fullName||l.name||`${l.firstName||""} ${l.lastName||""}`.trim()||"Unnamed Patient";return e.jsxs("div",{className:"bg-[var(--five)] rounded-xl p-4 text-white w-full max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Select Patient"}),e.jsxs("p",{className:"text-sm text-gray-400",children:[d.length," patient(s) found"]})]}),n&&e.jsx("button",{onClick:n,className:"px-3 py-1.5 rounded bg-white/10 hover:bg-white/20 cursor-pointer text-sm transition-colors",children:"Close"})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{value:i,onChange:l=>c(l.target.value),placeholder:"Search by name or ID...",className:"w-full bg-black/30 rounded-lg pl-10 pr-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsx("div",{className:"max-h-80 overflow-auto divide-y divide-white/10 rounded-lg border border-white/10",children:d.length===0?e.jsxs("div",{className:"py-6 text-center",children:[e.jsx("div",{className:"text-white/60 mb-2",children:"No patients found"}),i&&e.jsx("button",{onClick:()=>c(""),className:"text-blue-400 hover:text-blue-300 text-sm cursor-pointer",children:"Clear search"})]}):d.map(l=>e.jsxs("button",{type:"button",onClick:()=>t?.(l),className:"w-full text-left p-4 hover:bg-white/5 transition-colors flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-medium",children:x(l).charAt(0).toUpperCase()}),e.jsxs("div",{className:"ml-4 flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsx("p",{className:"text-sm font-medium text-white truncate",children:x(l)}),l.gender&&e.jsx("span",{className:"ml-2 text-xs text-gray-400",children:l.gender})]}),e.jsxs("div",{className:"mt-1 flex items-center text-xs text-gray-400",children:[e.jsxs("span",{className:"truncate",children:["ID: ",l._id||l.id||"N/A"]}),l.cardId&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-white/10 rounded-full",children:["Card: ",l.cardId]})]})]})]},l._id))})]})},pt=({status:a})=>{const t={scheduled:{bg:"bg-yellow-600/20",text:"text-yellow-300"},"checked-in":{bg:"bg-green-600/20",text:"text-green-300"},completed:{bg:"bg-blue-600/20",text:"text-blue-300"},cancelled:{bg:"bg-red-600/20",text:"text-red-300"}},{bg:n,text:i}=t[a?.toLowerCase()]||{bg:"bg-gray-600/20",text:"text-gray-300"},c=a?.charAt(0).toUpperCase()+a?.slice(1)||"Pending";return e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${n} ${i}`,children:c})},ft=({appointments:a,onEdit:t,onDelete:n,loading:i=!1})=>{const c=d=>d?new Date(d).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"-";return i?e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx("div",{className:"text-white/60",children:"Loading appointments..."})}):e.jsx("div",{className:"bg-[#1a1a2e] rounded-lg overflow-hidden border border-white/10",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-white/5",children:[e.jsx("thead",{className:"bg-black/30",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white/70 uppercase tracking-wider",children:"Patient"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white/70 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white/70 uppercase tracking-wider",children:"Time"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white/70 uppercase tracking-wider",children:"Department"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-white/70 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-white/70 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:!Array.isArray(a)||a.length===0?e.jsx("tr",{children:e.jsx("td",{className:"px-6 py-8 text-center text-white/50",colSpan:6,children:"No appointments scheduled yet"})}):a.map(d=>e.jsxs("tr",{className:"hover:bg-white/5 transition-colors text-left",children:[e.jsx("td",{className:"px-6 py-4 ",children:e.jsx("div",{className:"text-sm font-medium text-white",children:d.PatientName})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-white/90",children:c(d.date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-white/90",children:d.time||d.timeSlot||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-white/90",children:d.department||"General"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(pt,{status:d.status||"scheduled"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsx("div",{className:"flex justify-end space-x-2",children:n&&e.jsx("button",{onClick:()=>n(d),className:"px-3 py-1 rounded bg-red-600/30 cursor-pointer text-white hover:bg-red-600/40 text-xs transition-colors",children:e.jsx(Z,{className:"w-4 h-4"})})})})]},d.id||d._id))})]})})})},gt=()=>{const{appointments:a=[],loading:t}=N(g=>g.appointments||{}),n=q();X();const i=D(),[c,d]=u.useState(!1),[x,l]=u.useState(null),[p,o]=u.useState([]),[f,s]=u.useState(!1);u.useEffect(()=>{(async()=>{try{s(!0),await i(L()).unwrap()}catch(w){console.error("Error loading appointments:",w)}finally{s(!1)}})()},[i]);const h=g=>{l(null),n("/nurses/appointments")},r=()=>{l(null),n("/nurses/appointments")},m=g=>{},j=async g=>{if(window.confirm("Are you sure you want to delete this appointment?"))try{await i(J(g._id)).unwrap(),U.success("Appointment deleted successfully")}catch(w){console.error("Error deleting appointment:",w),U.error(w.message||"Failed to delete appointment")}},v=u.useMemo(()=>Le([g=>g.user],g=>({users:(g?.users||[]).filter(G=>G.role==="Patient"),loading:g?.loading||!1,error:g?.error})),[]),{users:b,loading:W,error:I}=N(v);u.useEffect(()=>{i(_())},[i]);const Y=g=>{n("/nurses/appointments/create",{state:{patientId:g._id,patientName:g.fullName||g.name||`${g.firstName||""} ${g.lastName||""}`.trim()}})};return e.jsx("div",{className:"min-h-screen bg-[var(--one)] p-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[x?e.jsxs("div",{className:"bg-[var(--six)] rounded-xl p-6",children:[e.jsxs("div",{className:"mb-6 p-4 bg-[var(--five)] rounded-lg",children:[e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Patient Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400",children:"Name"}),e.jsx("p",{className:"text-white",children:x.name})]}),x.gender&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400",children:"Gender"}),e.jsx("p",{className:"text-white capitalize",children:x.gender})]}),x.phone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400",children:"Phone"}),e.jsx("p",{className:"text-white",children:x.phone})]}),x.bloodGroup&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400",children:"Blood Group"}),e.jsx("p",{className:"text-white",children:x.bloodGroup})]})]})]}),e.jsx(Re,{initial:{patient:x.name,patientId:x._id},onSubmit:h,onCancel:r})]}):e.jsx("div",{className:"bg-[var(--six)] rounded-xl p-6 text-center",children:W?e.jsxs("div",{className:"py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-400",children:"Loading patients..."})]}):I?e.jsxs("div",{className:"py-12",children:[e.jsxs("p",{className:"text-red-400",children:["Error loading patients: ",I]}),e.jsx("button",{onClick:()=>i(_()),className:"mt-4 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg flex items-center gap-2 mx-auto",children:"Retry"})]}):e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:"Appointments"}),e.jsxs("button",{onClick:()=>d(!0),disabled:b.length===0,className:`px-4 py-2 ${b.length===0?"bg-gray-600 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700"} text-white rounded-lg flex items-center gap-2`,children:[e.jsx(Oe,{className:"w-4 h-4"}),"New Appointment"]})]}),t?e.jsxs("div",{className:"py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-400 text-center",children:"Loading appointments..."})]}):b.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(k,{className:"w-12 h-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-white mb-2",children:"No patients found"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Please add patients first to create appointments"})]}):e.jsx(ft,{appointments:Array.isArray(a)?a:[],onEdit:m,onDelete:j,loading:t})]})}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"w-full max-w-2xl",children:e.jsx(ht,{patients:b,onSelect:Y,onClose:()=>d(!1)})})})]})})},jt=()=>{const a=D(),{appointments:t=[],loading:n}=N(o=>o.appointments||{}),[i,c]=u.useState(1);u.useEffect(()=>{(!t||t.length===0)&&a(L())},[t,a]);const d=u.useMemo(()=>{const o=Math.max(1,Math.min(4,Number(i)))*7,s=Array.from({length:o}).map((h,r)=>{const m=R(new Date,o-1-r);return{date:m,label:He(m,o>14?"MM/dd":"EEE")}}).map(h=>({name:h.label,date:h.date,count:0}));for(const h of t){let r=h?.date;if(r){if(typeof r=="string")try{r=T(r)}catch{continue}else r=new Date(r);for(const m of s)if(M(r,m.date)){m.count+=1;break}}}return s.map(h=>({name:h.name,count:h.count}))},[t,i]),x=d.reduce((o,f)=>o+f.count,0),l=u.useMemo(()=>{const o=Math.max(1,Math.min(4,Number(i)))*7,f=R(new Date,o-1),s={scheduled:0,completed:0,cancelled:0};for(const h of t){let r=h?.date;if(r){if(typeof r=="string")try{r=T(r)}catch{continue}else r=new Date(r);if(We(r,{start:f,end:new Date})){const m=(h.status||"scheduled").toLowerCase();m==="completed"?s.completed+=1:m==="cancelled"||m==="rejected"?s.cancelled+=1:s.scheduled+=1}}}return[{name:"Scheduled",value:s.scheduled},{name:"Completed",value:s.completed},{name:"Cancelled",value:s.cancelled}]},[t,i]),p=["#60A5FA","#34D399","#F87171"];return e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Weekly Appointments"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Last ",i," week",i>1?"s":""," (",i*7," days)"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold",children:x}),e.jsx("div",{className:"text-sm text-gray-500",children:"Total appointments"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm block mb-1",children:"Range"}),e.jsxs("select",{value:i,onChange:o=>c(Number(o.target.value)),className:"border rounded px-2 py-1 text-sm",children:[e.jsx("option",{value:1,children:"1 week"}),e.jsx("option",{value:2,children:"2 weeks"}),e.jsx("option",{value:3,children:"3 weeks"}),e.jsx("option",{value:4,children:"4 weeks"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"md:col-span-2",style:{width:"100%",height:300},children:e.jsx(P,{children:e.jsxs(Ye,{data:d,margin:{top:10,right:20,left:0,bottom:0},children:[e.jsx(Ie,{strokeDasharray:"3 3"}),e.jsx(Ue,{dataKey:"name"}),e.jsx(Ee,{allowDecimals:!1}),e.jsx(Pe,{}),e.jsx(Ge,{dataKey:"count",fill:"#4f46e5"})]})})}),e.jsxs("div",{className:"md:col-span-1 bg-white p-4 rounded",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Status Breakdown"}),e.jsx("div",{style:{width:"100%",height:220},children:e.jsx(P,{children:e.jsxs(Ke,{children:[e.jsx(Ze,{data:l,dataKey:"value",nameKey:"name",innerRadius:40,outerRadius:70,paddingAngle:4,children:l.map((o,f)=>e.jsx(qe,{fill:p[f%p.length]},`cell-${f}`))}),e.jsx($e,{verticalAlign:"bottom",height:36})]})})})]})]}),n&&e.jsx("div",{className:"mt-3 text-sm text-gray-600",children:"Loading latest appointments..."})]})},Nt=({user:a})=>{const t=D(),{currentUser:n}=N(s=>s.auth),{messages:i,loading:c}=N(s=>s.messages),[d,x]=u.useState(""),[l,p]=u.useState(null),o=u.useRef(null);u.useEffect(()=>{if(!n)return;const s=localStorage.getItem("token"),h=z(s);return h.on("new_message",r=>{const m=r.sender?._id||r.sender,j=r.receiver?._id||r.receiver;(m===a._id&&j===n.id||m===n.id&&j===a._id)&&(t(Q(r)),m===a._id&&t(E({from:a._id})))}),h.on("message_updated",r=>{t(V(r))}),()=>{h.off("new_message"),h.off("message_updated")}},[a,n,t]),u.useEffect(()=>{a&&a._id&&n?.id&&(t(ee({userA:n.id,userB:a._id})),t(E({from:a._id})),p(null),x(""))},[a,n,t]),u.useEffect(()=>{x(l?l.content:"")},[l]),u.useEffect(()=>{o.current?.scrollIntoView({behavior:"smooth"})},[i]);const f=()=>{const s=d.trim();if(s){if(l)le(t,l._id,s,p);else{if(!a?._id)return;t(de({receiver:a._id,content:s}))}x("")}};return e.jsxs("div",{className:"flex flex-col h-[70vh]",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:[c&&e.jsx("div",{className:"text-gray-300",children:"Loading..."}),i.map(s=>e.jsxs("div",{className:`max-w-[75%] px-3 py-2 rounded-md group relative ${s.sender?._id===n.id?"bg-blue-600 text-white ml-auto":"bg-gray-700 text-white"}`,children:[e.jsx("div",{className:"text-sm break-words",children:s.content||s.text}),e.jsxs("div",{className:`text-[10px] mt-1 flex items-center justify-end gap-1 ${s.sender?._id===n.id?"text-blue-200":"text-gray-400"}`,children:[e.jsx("span",{children:new Date(s.createdAt||s.sentAt||Date.now()).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),s.sender?._id===n.id&&(s.status==="read"?e.jsx(te,{size:12,className:"text-white"}):e.jsx(se,{size:12,className:"text-white"}))]}),s.sender?._id===n.id&&e.jsx("div",{className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(ae,{onEdit:()=>ie(p,s),onDelete:()=>ne(t,s._id)})})]},s._id||s.id)),e.jsx("div",{ref:o})]}),e.jsxs("div",{className:"p-3 border-t border-[var(--four)] flex gap-2 items-center",children:[l&&e.jsx("button",{onClick:()=>p(null),className:"text-red-500 hover:bg-red-100 p-2 rounded-full",children:e.jsx(re,{size:20})}),e.jsx("input",{value:d,onChange:s=>x(s.target.value),onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),f())},placeholder:l?"Edit message...":a?"Type a message...":"Select a user to start chatting",className:"flex-1 bg-transparent border border-gray-700 rounded-md p-2 text-white focus:outline-none focus:ring-2 focus:ring-[var(--one)]"}),e.jsx("button",{onClick:f,disabled:!a&&!l||!d.trim(),className:"px-4 py-2 rounded-md bg-[var(--one)] text-black disabled:opacity-50",children:l?"Update":"Send"})]})]})},vt=()=>{const a=D(),{users:t,loading:n}=N(r=>r.user),{currentUser:i}=N(r=>r.auth),{unreadCounts:c}=N(r=>r.messages),[d,x]=u.useState(""),[l,p]=u.useState(null);u.useEffect(()=>{a(_())},[a]),u.useEffect(()=>{if(!i)return;const r=localStorage.getItem("token"),m=z(r);return m.on("new_message",j=>{const v=j.sender?._id||j.sender;(j.receiver?._id||j.receiver)===i.id&&v!==l&&a(ce(v))}),()=>{m.off("new_message")}},[i,l,a]);const o=u.useMemo(()=>(t||[]).filter(r=>r.role==="Doctor"||r.role==="Admin"),[t]),f=u.useMemo(()=>{const r=d.trim().toLowerCase();return r?o.filter(m=>(m.fullName||`${m.firstName||""} ${m.lastName||""}`).toLowerCase().includes(r)||(m.phone||m.phoneNumber||"").toLowerCase().includes(r)):o},[o,d]),s=u.useMemo(()=>f.find(r=>(r._id||r.id)===l)||o.find(r=>(r._id||r.id)===l),[f,o,l]);u.useEffect(()=>{!l&&f.length>0&&p(f[0]._id||f[0].id)},[f,l]);const h=r=>{p(r),a(me(r))};return e.jsxs("div",{className:"p-4 md:p-6 bg-[var(--six)] rounded-xl min-h-[70vh] grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"col-span-1 border border-[var(--two)] rounded-lg overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-3 border-b border-[var(--two)] text-white flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{className:"font-semibold",children:"Inbox"})]}),e.jsx("div",{className:"p-3",children:e.jsx("input",{value:d,onChange:r=>x(r.target.value),placeholder:"Search patients...",className:"w-full bg-transparent border border-gray-700 rounded-md p-2 text-white focus:outline-none focus:ring-2 focus:ring-[var(--one)]"})}),e.jsxs("div",{className:"flex-1 overflow-y-auto divide-y divide-[var(--two)]",children:[n&&e.jsx("div",{className:"p-3 text-gray-300",children:"Loading..."}),!n&&f.map(r=>{const m=r._id||r.id,j=r.fullName||`${r.firstName||""} ${r.lastName||""}`,v=c[m]||0;return e.jsx("button",{onClick:()=>h(m),className:`w-full text-left p-3 hover:bg-[var(--five)] ${l===m?"bg-[var(--four)]":""}`,children:e.jsxs("div",{className:"flex items-center gap-2 text-white",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-[var(--one)] flex items-center justify-center text-black",children:e.jsx(k,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:j}),e.jsx("div",{className:"text-xs text-gray-300 truncate",children:r.phone||r.phoneNumber||"No phone"})]}),v>0&&e.jsx("div",{className:"bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center",children:v>9?"9+":v})]})},m)}),!n&&f.length===0&&e.jsx("div",{className:"p-3 text-gray-300",children:"No Patients Found"})]})]}),e.jsxs("div",{className:"col-span-1 md:col-span-2 border border-[var(--four)] rounded-lg flex flex-col overflow-hidden bg-[var(--six)]",children:[e.jsxs("div",{className:"p-3 border-b border-[var(--four)] text-white flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx("span",{className:"font-semibold",children:s?s.fullName||`${s.firstName||""} ${s.lastName||""}`:"Select a User"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(Nt,{user:s})})]})]})},F=()=>{const a=D(),{currentUser:t}=N(s=>s.auth),{appointments:n=[],loading:i}=N(s=>s.appointments||{}),{notifications:c=[],loading:d}=N(s=>s.notifications),x=()=>{a(pe()),navigate("/")};u.useEffect(()=>{(!n||n.length===0)&&a(L()),a(xe())},[n,a]);const l=s=>{if(!s)return null;if(typeof s=="string")try{return T(s)}catch{return new Date(s)}return new Date(s)},p=new Date,o=u.useMemo(()=>{const s={totalAppointments:0,todayAppointments:0,patientsToday:new Set,scheduled:0,completed:0,cancelled:0};for(const h of n){s.totalAppointments+=1;const r=l(h.date);if(!r)continue;M(r,p)&&(s.todayAppointments+=1,h.patient&&s.patientsToday.add(String(h.patient)));const m=(h.status||"scheduled").toLowerCase();m==="completed"?s.completed+=1:m==="cancelled"||m==="rejected"?s.cancelled+=1:s.scheduled+=1}return{totalAppointments:s.totalAppointments,todayAppointments:s.todayAppointments,patientsToday:s.patientsToday.size,scheduled:s.scheduled,completed:s.completed,cancelled:s.cancelled}},[n]),f=u.useMemo(()=>n.map(s=>({...s,_parsedDate:l(s.date)})).filter(s=>s._parsedDate&&(Qe(s._parsedDate,p)||M(s._parsedDate,p))).sort((s,h)=>s._parsedDate-h._parsedDate).slice(0,5),[n]);return e.jsx("div",{className:"min-h-screen w-full bg-[var(--one)] p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 bg-[var(--three)] rounded-xl p-4",children:[e.jsxs("h1",{className:"text-white border-1 px-3 py-1 rounded-xl",children:[t?.gender==="Male"?"Mr":t?.gender==="Female"?"Ms":"Mr/Ms"," ",t?.fullName]}),e.jsx("h1",{className:"text-white",children:t?.role}),e.jsxs(ue,{className:"cursor-pointer px-10 hover:bg-[var(--five)]",onClick:x,children:["LogOut ",e.jsx(Je,{})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-[var(--three)] rounded-xl p-5",children:[e.jsx("div",{className:"text-sm text-gray-300",children:"Patients Today"}),e.jsx("div",{className:"text-3xl font-bold text-white mt-2",children:o.patientsToday})]}),e.jsxs("div",{className:"bg-[var(--six)] rounded-xl p-5",children:[e.jsx("div",{className:"text-sm text-gray-300",children:"Today's Appointments"}),e.jsx("div",{className:"text-3xl font-bold text-white mt-2",children:o.todayAppointments})]}),e.jsxs("div",{className:"bg-[var(--six)] rounded-xl p-5",children:[e.jsx("div",{className:"text-sm text-gray-300",children:"Total Appointments"}),e.jsx("div",{className:"text-3xl font-bold text-white mt-2",children:o.totalAppointments})]})]}),e.jsxs("div",{className:"mt-6 mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:[e.jsx(he,{className:"inline-block mr-2"}),"Announcements"]}),d&&e.jsx("p",{className:"text-gray-500",children:"Loading notifications..."}),!d&&c.length===0&&e.jsx("p",{className:"text-gray-500",children:"No announcements at the moment."}),e.jsx("div",{className:"space-y-4",children:c.map(s=>e.jsxs("div",{className:`border rounded-lg p-4 ${s.type==="alert"?"bg-red-100/10 border-red-200":s.type==="announcement"?"bg-blue-100/10 border-blue-200":"bg-green-100/10 border-green-200"}`,children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:s.title}),e.jsx("p",{className:"text-gray-600 mt-1",children:s.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:new Date(s.createdAt).toLocaleDateString()})]},s._id))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-6",children:[e.jsxs("div",{className:"bg-[var(--six)] rounded-xl p-5",children:[e.jsx("div",{className:"text-sm text-gray-300",children:"Scheduled"}),e.jsx("div",{className:"text-2xl font-bold text-white mt-2",children:o.scheduled})]}),e.jsxs("div",{className:"bg-[var(--six)] rounded-xl p-5",children:[e.jsx("div",{className:"text-sm text-gray-300",children:"Completed"}),e.jsx("div",{className:"text-2xl font-bold text-white mt-2",children:o.completed})]}),e.jsxs("div",{className:"bg-[var(--six)] rounded-xl p-5",children:[e.jsx("div",{className:"text-sm text-gray-300",children:"Cancelled"}),e.jsx("div",{className:"text-2xl font-bold text-white mt-2",children:o.cancelled})]})]}),e.jsxs("div",{className:"mt-8 bg-[var(--four)] rounded-xl p-4",children:[e.jsx("h3",{className:"text-white mb-3",children:"Next appointments"}),f.length===0?e.jsx("div",{className:"text-gray-200",children:"No upcoming appointments"}):e.jsx("ul",{className:"space-y-3",children:f.map(s=>e.jsxs("li",{className:"bg-[var(--one)]/10 p-3 rounded",children:[e.jsx("div",{className:"text-white font-medium",children:s.PatientName||s.patientName||"Patient"}),e.jsx("div",{className:"text-sm text-gray-300",children:l(s.date)?.toLocaleString()}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Status: ",s.status||"scheduled"]})]},s._id))})]})]})})},bt=[{title:"Home",icon:ye},{title:"Inbox",icon:De},{title:"Appointment",icon:k},{title:"Reports",icon:Ce},{title:"Settings",icon:ke}],wt=()=>{const[a,t]=u.useState("");return e.jsxs(fe,{children:[e.jsxs(ge,{children:[e.jsx(je,{className:"bg-[var(--six)]",children:e.jsxs(Ne,{children:[e.jsx(ve,{className:" text-[var(--two)] text-[19px] mb-10 font-bold",children:"NURSE DASHBOARD"}),e.jsx(be,{children:e.jsx(we,{children:bt.map(n=>e.jsx(Se,{children:e.jsx(Ae,{asChild:!0,className:"hover:bg-[var(--three)] hover:text-[var(--six)]",children:e.jsxs("button",{onClick:()=>t(n.title),children:[e.jsx(n.icon,{className:"text-[var(--two)]"}),e.jsx("span",{className:"text-[var(--two)]  ",children:n.title})]})})},n.title))})})]})}),e.jsx(_e,{})]}),e.jsxs("main",{className:"flex-1 p-4",children:[e.jsx(Me,{}),a==="Home"?e.jsx(F,{}):a==="Inbox"?e.jsx(vt,{}):a==="Appointment"?e.jsx(gt,{}):a==="Reports"?e.jsx(jt,{}):a==="Settings"?e.jsx(Te,{}):e.jsx(F,{})]})]})},St=()=>e.jsx("div",{children:e.jsx(wt,{})});export{St as default};

import{b as N,e as j,r as d,W as M,j as e,bf as E,C as _,a as D,U as S,ae as I,B as L,af as A,a0 as U,a1 as v,a2 as $,a3 as B,a5 as P,a6 as R,a7 as T,a8 as H,a9 as z,X as O,aa as k,ab as F,ac as G,O as q,ad as K,f as Y,a4 as Q,al as V,am as W,an as X,ao as J,ap as Z,aq as ee,ar as se,as as te,at as ae,av as re,aw as ne,ax as ie,E as le,ay as de,az as ce}from"./index-CZaaagKj.js";import{B as oe}from"./building-2-C1_VuXxL.js";const xe=()=>{const a=N(),{appointments:i,loading:n,error:c}=j(r=>r.appointments),{currentUser:g}=j(r=>r.auth);d.useEffect(()=>{a(M())},[a]);const x=d.useMemo(()=>!g||!i||!Array.isArray(i)?[]:i.filter(r=>r.patient&&typeof r.patient=="object"?r.patient._id===g.id:r.patient===g.id).sort((r,m)=>new Date(r.date)-new Date(m.date)),[i,g]),u=r=>new Date(r).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}),l=r=>{switch(r?.toLowerCase()){case"scheduled":case"pending":return"bg-blue-500";case"completed":return"bg-green-500";case"cancelled":return"bg-red-500";default:return"bg-gray-500"}};return n?e.jsx("div",{className:"min-h-screen w-full bg-[var(--one)] p-4 md:p-6 flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(E,{className:"w-8 h-8 animate-spin text-blue-500"}),e.jsx("p",{className:"text-gray-600",children:"Loading appointments..."})]})}):c?e.jsx("div",{className:"min-h-screen w-full bg-[var(--one)] p-4 md:p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-6",children:"My Appointments"}),e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-red-700",children:c})]})}):e.jsx("div",{className:"min-h-screen w-full bg-[var(--one)] p-4 md:p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-6",children:"My Appointments"}),x.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8 text-center",children:[e.jsx(_,{className:"w-16 h-16 mx-auto text-gray-300 mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-700 mb-2",children:"No Appointments Yet"}),e.jsx("p",{className:"text-gray-500",children:"You don't have any scheduled appointments at this time."})]}):e.jsx("div",{className:"space-y-4",children:x.map(r=>e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-blue-500"}),e.jsx("span",{className:"font-semibold text-gray-800",children:u(r.date)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{className:"text-gray-700",children:r.timeSlot||"Not specified"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5 text-gray-500"}),e.jsxs("span",{className:"text-gray-700",children:["Dr. ",r.doctor?.fullName||"Not assigned",r.doctor?.speciality&&e.jsxs("span",{className:"text-gray-500 text-sm ml-2",children:["(",r.doctor.speciality,")"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5 text-gray-500"}),e.jsx("span",{className:"text-gray-700",children:r.department||"General"})]})]}),e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:`${l(r.status)} text-white px-4 py-2 rounded-full text-sm font-medium capitalize`,children:r.status||"Pending"})})]}),r.reason&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Reason: "}),r.reason]})})]},r._id))}),x.length>0&&e.jsx("div",{className:"mt-6 bg-blue-50 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-blue-800",children:["Total appointments: ",e.jsx("span",{className:"font-semibold",children:x.length})]})})]})})},C=()=>{const a=N(),{notifications:i=[],loading:n}=j(c=>c.notifications);return d.useEffect(()=>{a(I())},[a]),e.jsxs("div",{className:"min-h-screen w-full bg-[var(--one)] p-4 md:p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Patient Dashboard"}),e.jsx("div",{children:e.jsx(L,{className:"float-right p-2 m-3",children:"My Medical Information"})}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:[e.jsx(A,{className:"inline-block mr-2"}),"Announcements"]}),n&&e.jsx("p",{className:"text-gray-500",children:"Loading notifications..."}),!n&&i.length===0&&e.jsx("p",{className:"text-gray-500",children:"No announcements at the moment."}),e.jsx("div",{className:"space-y-4",children:i.map(c=>e.jsxs("div",{className:`border rounded-lg p-4 ${c.type==="alert"?"bg-red-100/10 border-red-200":c.type==="announcement"?"bg-blue-100/10 border-blue-200":"bg-green-100/10 border-green-200"}`,children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:c.title}),e.jsx("p",{className:"text-gray-600 mt-1",children:c.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:new Date(c.createdAt).toLocaleDateString()})]},c._id))})]}),e.jsx(xe,{})]})};let w;const me=a=>(w||(w=k("http://localhost:5000",{auth:{token:a},withCredentials:!0})),w),he=({user:a})=>{const i=N(),{currentUser:n}=j(t=>t.auth),{messages:c,loading:g}=j(t=>t.messages),[x,u]=d.useState(""),[l,r]=d.useState(null),m=d.useRef(null);d.useEffect(()=>{if(!n)return;const t=localStorage.getItem("token"),p=me(t);return p.on("new_message",s=>{const o=s.sender?._id||s.sender,f=s.receiver?._id||s.receiver;(o===a._id&&f===n.id||o===n.id&&f===a._id)&&(i(U(s)),o===a._id&&i(v({from:a._id})))}),p.on("message_updated",s=>{i($(s))}),p.on("messages_read",s=>{(s.fromUser===n.id||s.conversationId)&&i(v({from:n.id,isReadReceipt:!0}))}),()=>{p.off("new_message"),p.off("message_updated"),p.off("messages_read")}},[a,n,i]),d.useEffect(()=>{a&&a._id&&n?.id&&(i(B({userA:n.id,userB:a._id})),i(v({from:a._id})),r(null),u(""))},[a,n,i]),d.useEffect(()=>{u(l?l.content:"")},[l]),d.useEffect(()=>{m.current?.scrollIntoView({behavior:"smooth"})},[c]);const h=()=>{const t=x.trim();if(t){if(l)F(i,l._id,t,r);else{if(!a?._id)return;i(G({receiver:a._id,content:t}))}u("")}};return e.jsxs("div",{className:"flex flex-col h-[70vh]",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-2",children:[g&&e.jsx("div",{className:"text-gray-300",children:"Loading..."}),c.map(t=>e.jsxs("div",{className:`max-w-[75%] px-3 py-2 rounded-md group relative ${t.sender?._id===n.id?"bg-blue-600 text-white ml-auto":"bg-gray-700 text-white"}`,children:[e.jsx("div",{className:"text-sm break-words",children:t.content||t.text}),e.jsxs("div",{className:`text-[10px] mt-1 flex items-center justify-end gap-1 ${t.sender?._id===n.id?"text-blue-200":"text-gray-400"}`,children:[e.jsx("span",{children:new Date(t.createdAt||t.sentAt||Date.now()).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),t.sender?._id===n.id&&(t.status==="read"?e.jsx(P,{size:12,className:"text-white"}):e.jsx(R,{size:12,className:"text-white"}))]}),t.sender?._id===n.id&&e.jsx("div",{className:"absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(T,{onEdit:()=>z(r,t),onDelete:()=>H(i,t._id)})})]},t._id||t.id)),e.jsx("div",{ref:m})]}),e.jsxs("div",{className:"p-3 border-t border-[var(--four)] flex gap-2 items-center",children:[l&&e.jsx("button",{onClick:()=>r(null),className:"text-red-500 hover:bg-red-100 p-2 rounded-full",children:e.jsx(O,{size:20})}),e.jsx("input",{value:x,onChange:t=>u(t.target.value),onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),h())},placeholder:l?"Edit message...":a?"Type a message...":"Select a user to start chatting",className:"flex-1 bg-transparent border border-gray-700 rounded-md p-2 text-white focus:outline-none focus:ring-2 focus:ring-[var(--one)]"}),e.jsx("button",{onClick:h,disabled:!a&&!l||!x.trim(),className:"px-4 py-2 rounded-md bg-[var(--one)] text-black disabled:opacity-50",children:l?"Update":"Send"})]})]})};let y;const ue=a=>(y||(y=k("http://localhost:5000",{auth:{token:a},withCredentials:!0})),y),fe=()=>{const a=N(),{users:i,loading:n}=j(s=>s.user),{currentUser:c}=j(s=>s.auth),{unreadCounts:g}=j(s=>s.messages),[x,u]=d.useState(""),[l,r]=d.useState(null);d.useEffect(()=>{a(q())},[a]),d.useEffect(()=>{if(!c)return;const s=localStorage.getItem("token"),o=ue(s);return o.on("new_message",f=>{const b=f.sender?._id||f.sender;(f.receiver?._id||f.receiver)===c.id&&b!==l&&a(K(b))}),()=>{o.off("new_message")}},[c,l,a]);const m=d.useMemo(()=>(i||[]).filter(s=>s.role==="Receptionist"),[i]),h=d.useMemo(()=>{const s=x.trim().toLowerCase();return s?m.filter(o=>(o.fullName||`${o.firstName||""} ${o.lastName||""}`).toLowerCase().includes(s)||(o.phone||o.phoneNumber||"").toLowerCase().includes(s)):m},[m,x]),t=d.useMemo(()=>h.find(s=>(s._id||s.id)===l)||m.find(s=>(s._id||s.id)===l),[h,m,l]);d.useEffect(()=>{!l&&h.length>0&&r(h[0]._id||h[0].id)},[h,l]);const p=s=>{r(s),a(Q(s))};return e.jsxs("div",{className:"p-4 md:p-6 bg-[var(--six)] rounded-xl min-h-[70vh] grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"col-span-1 border border-[var(--two)] rounded-lg overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-3 border-b border-[var(--two)] text-white flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{className:"font-semibold",children:"Inbox"})]}),e.jsx("div",{className:"p-3",children:e.jsx("input",{value:x,onChange:s=>u(s.target.value),placeholder:"Search patients...",className:"w-full bg-transparent border border-gray-700 rounded-md p-2 text-white focus:outline-none focus:ring-2 focus:ring-[var(--one)]"})}),e.jsxs("div",{className:"flex-1 overflow-y-auto divide-y divide-[var(--two)]",children:[n&&e.jsx("div",{className:"p-3 text-gray-300",children:"Loading..."}),!n&&h.map(s=>{const o=s._id||s.id,f=s.fullName||`${s.firstName||""} ${s.lastName||""}`,b=g[o]||0;return e.jsx("button",{onClick:()=>p(o),className:`w-full text-left p-3 hover:bg-[var(--five)] ${l===o?"bg-[var(--four)]":""}`,children:e.jsxs("div",{className:"flex items-center gap-2 text-white",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-[var(--one)] flex items-center justify-center text-black",children:e.jsx(S,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:f}),e.jsx("div",{className:"text-xs text-gray-300 truncate",children:s.phone||s.phoneNumber||"No phone"})]}),b>0&&e.jsx("div",{className:"bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center",children:b>9?"9+":b})]})},o)}),!n&&h.length===0&&e.jsx("div",{className:"p-3 text-gray-300",children:"No Patients Found"})]})]}),e.jsxs("div",{className:"col-span-1 md:col-span-2 border border-[var(--four)] rounded-lg flex flex-col overflow-hidden bg-[var(--six)]",children:[e.jsxs("div",{className:"p-3 border-b border-[var(--four)] text-white flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4"}),e.jsx("span",{className:"font-semibold",children:t?t.fullName||`${t.firstName||""} ${t.lastName||""}`:"Select a User"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(he,{user:t})})]})]})},ge=[{title:"Home",icon:te},{title:"Inbox",icon:ae},{title:"Settings",icon:re}],pe=()=>{const[a,i]=d.useState("");return e.jsxs(V,{children:[e.jsxs(W,{children:[e.jsx(X,{className:"bg-[var(--six)]",children:e.jsxs(J,{children:[e.jsx(Z,{className:" text-[var(--two)] text-[18px] mb-10 font-bold",children:"PATIENTS DASHBOARD"}),e.jsx(ee,{children:e.jsx(se,{children:ge.map(n=>e.jsx(ne,{children:e.jsx(ie,{asChild:!0,className:"hover:bg-[var(--three)] hover:text-[var(--six)]",children:e.jsxs("button",{onClick:()=>i(n.title),children:[e.jsx(n.icon,{className:"text-[var(--two)]"}),e.jsx("span",{className:"text-[var(--two)]  ",children:n.title})]})})},n.title))})})]})}),e.jsx(le,{})]}),e.jsxs("main",{className:"flex-1 p-4",children:[e.jsx(de,{}),a==="Home"?e.jsx(C,{}):a==="Inbox"?e.jsx(fe,{}):a==="Settings"?e.jsx(ce,{}):e.jsx(C,{})]})]})},ve=()=>e.jsx("div",{children:e.jsx(pe,{})});export{ve as default};

import{aA as P,d as k,b as B,e as v,r,j as e,t as j,aE as _}from"./index-CZaaagKj.js";const G=()=>{const l=P(),u=k(),N=B(),g=v(t=>t.appointments?.loading),{users:i}=v(t=>t.user),[c,D]=r.useState([]),[x,w]=r.useState([]),[T,F]=r.useState(!1),[L,O]=r.useState("");r.useEffect(()=>{console.log("Users from Redux:",i)},[i]);const[b,h]=r.useState(!1),[f,y]=r.useState(""),[a,m]=r.useState({patient:l.state?.patientName||"",patientId:l.state?.patientId||"",date:new Date().toISOString().slice(0,10),time:"",department:"General",doctor:"",status:"Pending",age:l.state?.age||"",bloodType:l.state?.bloodType||"A+",medicalDocument:""}),C=["General","Cardiology","Neurology","Pediatrics","Orthopedics","Dermatology"];r.useEffect(()=>{if(i&&Array.isArray(i)&&i.length>0){console.log("Filtering doctors and patients from users:",i);const t=i.filter(n=>n.role==="Doctor"),o=i.filter(n=>n.role==="Patient");console.log("Filtered doctors:",t),console.log("Filtered patients:",o),D(t),w(o),t.length>0&&!a.doctor&&m(n=>({...n,doctor:t[0]._id}))}},[i]);const p=()=>{if(!a.department)return[];const t=c.filter(o=>{if(!o.department)return!1;const n=o.department.toString().trim().toLowerCase(),s=a.department.toString().trim().toLowerCase();return console.log("Comparing doctor department:",{doctorName:o.fullName,doctorDept:o.department,formDept:a.department,match:n===s}),n===s});return console.log("Doctors for department",a.department,":",t),console.log("All available doctors:",c),t};r.useEffect(()=>{console.log("Current form state:",a),console.log("Available doctors:",c),console.log("Filtered doctors:",p())},[a.department,c]),r.useEffect(()=>{l.state&&m(t=>({...t,patient:l.state.patientName||t.patient,patientId:l.state.patientId||t.patientId,age:l.state.age||t.age,bloodType:l.state.bloodType||t.bloodType}))},[l.state]);const S=()=>u("/nurses/appointments"),A=t=>c.find(o=>o._id===t),d=t=>m({...a,[t.target.name]:t.target.value}),I=t=>{const o=t.target.value,n=x.find(s=>s._id===o);n&&m({...a,patientId:n._id,patient:n.fullName,age:n.age||"",bloodType:n.bloodGroup||"A+"})},E=async t=>{if(t.preventDefault(),!a.patient||!a.time||!a.doctor||!a.department){const o="Please fill in all required fields";y(o),j.error(o);return}try{h(!0),y("");const o=A(a.doctor);if(!o)throw new Error("Selected doctor not found");const n={PatientName:a.patient,patient:a.patientId,date:a.date,timeSlot:a.time,department:a.department,doctor:o._id,status:"scheduled",reason:a.reason||""},s=await N(_(n));if(s.error)throw new Error(s.payload||"Failed to create appointment");j.success("Appointment created successfully!"),u("/nurses/appointments")}finally{h(!1)}};return e.jsxs("form",{onSubmit:E,className:"space-y-6 p-8 bg-[var(--five)] rounded-lg shadow-md max-w-5xl mx-auto mt-2 ",children:[e.jsx("h3",{className:"text-4xl  font-bold text-gray-100 mb-6",children:"New Appointment"}),e.jsxs("div",{className:"bg-[var(--five)] p-4 rounded-lg mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-100 mb-3",children:"Select Patient"}),e.jsxs("select",{value:a.patientId,onChange:I,className:"w-full bg-white border border-gray-300 rounded px-3 py-2 text-gray-800",required:!0,children:[e.jsx("option",{value:"",children:"-- Select a Patient --"}),x.map(t=>e.jsxs("option",{value:t._id,children:[t.fullName," - ",t.email]},t._id))]})]}),e.jsxs("div",{className:"bg-[var(--five)] p-4 rounded-lg mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-100 mb-3",children:"Patient Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-1",children:"Full Name"}),e.jsx("input",{name:"patient",value:a.patient,onChange:d,className:"w-full bg-gray-100 border border-gray-300 rounded px-3 py-2 text-gray-600",disabled:!0,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-1",children:"Patient ID"}),e.jsx("input",{name:"patientId",value:a.patientId,onChange:d,className:"w-full bg-gray-100 border border-gray-300 rounded px-3 py-2 text-gray-600",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-1",children:"Age"}),e.jsx("input",{type:"number",name:"age",value:a.age,onChange:d,className:"w-full bg-white border border-gray-300 rounded px-3 py-2 text-gray-800",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-1",children:"Blood Type"}),e.jsxs("select",{name:"bloodType",value:a.bloodType,onChange:d,className:"w-full bg-white border border-gray-300 rounded px-3 py-2 text-gray-800",children:[e.jsx("option",{value:"A+",children:"A+"}),e.jsx("option",{value:"A-",children:"A-"}),e.jsx("option",{value:"B+",children:"B+"}),e.jsx("option",{value:"B-",children:"B-"}),e.jsx("option",{value:"AB+",children:"AB+"}),e.jsx("option",{value:"AB-",children:"AB-"}),e.jsx("option",{value:"O+",children:"O+"}),e.jsx("option",{value:"O-",children:"O-"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{type:"date",name:"date",value:a.date,onChange:d,className:"bg-black/30 rounded px-3 py-2 outline-none"}),e.jsx("input",{type:"time",name:"time",value:a.time,onChange:d,className:"bg-black/30 rounded px-3 py-2 outline-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("select",{name:"department",value:a.department,onChange:t=>{const o=t.target.value,n=c.filter(s=>s.department===o);m(s=>({...s,department:o,doctor:n.length>0?n[0]._id:""}))},className:"bg-black/30 rounded px-3 py-2 outline-none text-white",children:C.map(t=>e.jsx("option",{value:t,className:"bg-[var(--five)]",children:t},t))}),e.jsxs("select",{name:"doctor",value:a.doctor,onChange:d,className:"bg-black/30 rounded px-3 py-2 outline-none text-white",disabled:p().length===0,required:!0,children:[e.jsx("option",{value:"",children:"Select a doctor"}),p().map(t=>e.jsxs("option",{value:t._id,className:"bg-[var(--five)]",children:["Dr. ",t.fullName," ",t.speciality?`(${t.speciality})`:""]},t._id)),p().length===0&&e.jsx("option",{value:"",disabled:!0,children:"No doctors available in this department"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-1",children:"Medical Document (Optional)"}),e.jsx("input",{type:"text",name:"medicalDocument",value:a.medicalDocument,onChange:d,placeholder:"Medical document ID/URL",className:"w-full bg-[var(--five)] border border-gray-300 rounded px-3 py-2 text-gray-100 outline-none"})]}),f&&e.jsx("div",{className:"text-red-400 text-sm",children:f}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:S,className:"px-3 py-1 rounded bg-white/10",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:b||g,className:"px-3 py-1 rounded bg-green-400 text-black disabled:opacity-60",children:b||g?"Creating...":"Create"})]})]})};export{G as default};

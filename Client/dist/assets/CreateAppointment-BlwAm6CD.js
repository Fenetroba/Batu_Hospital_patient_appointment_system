import{aA as E,d as k,b as B,e as v,r as i,j as e,t as j,aE as _}from"./index-CiVVu7O9.js";const G=()=>{const o=E(),u=k(),N=B(),g=v(t=>t.appointments?.loading),{users:d}=v(t=>t.user),[m,w]=i.useState([]),[x,D]=i.useState([]),[T,L]=i.useState(!1),[O,q]=i.useState("");i.useEffect(()=>{},[d]);const[b,h]=i.useState(!1),[y,f]=i.useState(""),[a,c]=i.useState({patient:o.state?.patientName||"",patientId:o.state?.patientId||"",date:new Date().toISOString().slice(0,10),time:"",department:"General",doctor:"",status:"Pending",age:o.state?.age||"",bloodType:o.state?.bloodType||"A+",medicalDocument:""}),S=["General","Cardiology","Neurology","Pediatrics","Orthopedics","Dermatology"];i.useEffect(()=>{if(d&&Array.isArray(d)&&d.length>0){const t=d.filter(n=>n.role==="Doctor"),s=d.filter(n=>n.role==="Patient");w(t),D(s),t.length>0&&!a.doctor&&c(n=>({...n,doctor:t[0]._id}))}},[d]);const p=()=>a.department?m.filter(s=>{if(!s.department)return!1;const n=s.department.toString().trim().toLowerCase(),r=a.department.toString().trim().toLowerCase();return n===r}):[];i.useEffect(()=>{o.state&&c(t=>({...t,patient:o.state.patientName||t.patient,patientId:o.state.patientId||t.patientId,age:o.state.age||t.age,bloodType:o.state.bloodType||t.bloodType}))},[o.state]);const C=()=>u("/nurses/appointments"),A=t=>m.find(s=>s._id===t),l=t=>c({...a,[t.target.name]:t.target.value}),I=t=>{const s=t.target.value,n=x.find(r=>r._id===s);n&&c({...a,patientId:n._id,patient:n.fullName,age:n.age||"",bloodType:n.bloodGroup||"A+"})},P=async t=>{if(t.preventDefault(),!a.patient||!a.time||!a.doctor||!a.department){const s="Please fill in all required fields";f(s),j.error(s);return}try{h(!0),f("");const s=A(a.doctor);if(!s)throw new Error("Selected doctor not found");const n={PatientName:a.patient,patient:a.patientId,date:a.date,timeSlot:a.time,department:a.department,doctor:s._id,status:"scheduled",reason:a.reason||""},r=await N(_(n));if(r.error)throw new Error(r.payload||"Failed to create appointment");j.success("Appointment created successfully!"),u("/nurses/appointments")}finally{h(!1)}};return e.jsxs("form",{onSubmit:P,className:"space-y-6 p-8 bg-[var(--five)] rounded-lg shadow-md max-w-5xl mx-auto mt-2 ",children:[e.jsx("h3",{className:"text-4xl  font-bold text-gray-100 mb-6",children:"New Appointment"}),e.jsxs("div",{className:"bg-[var(--five)] p-4 rounded-lg mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-100 mb-3",children:"Select Patient"}),e.jsxs("select",{value:a.patientId,onChange:I,className:"w-full bg-white border border-gray-300 rounded px-3 py-2 text-gray-800",required:!0,children:[e.jsx("option",{value:"",children:"-- Select a Patient --"}),x.map(t=>e.jsxs("option",{value:t._id,children:[t.fullName," - ",t.email]},t._id))]})]}),e.jsxs("div",{className:"bg-[var(--five)] p-4 rounded-lg mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-100 mb-3",children:"Patient Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-1",children:"Full Name"}),e.jsx("input",{name:"patient",value:a.patient,onChange:l,className:"w-full bg-gray-100 border border-gray-300 rounded px-3 py-2 text-gray-600",disabled:!0,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-1",children:"Patient ID"}),e.jsx("input",{name:"patientId",value:a.patientId,onChange:l,className:"w-full bg-gray-100 border border-gray-300 rounded px-3 py-2 text-gray-600",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-1",children:"Age"}),e.jsx("input",{type:"number",name:"age",value:a.age,onChange:l,className:"w-full bg-white border border-gray-300 rounded px-3 py-2 text-gray-800",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-1",children:"Blood Type"}),e.jsxs("select",{name:"bloodType",value:a.bloodType,onChange:l,className:"w-full bg-white border border-gray-300 rounded px-3 py-2 text-gray-800",children:[e.jsx("option",{value:"A+",children:"A+"}),e.jsx("option",{value:"A-",children:"A-"}),e.jsx("option",{value:"B+",children:"B+"}),e.jsx("option",{value:"B-",children:"B-"}),e.jsx("option",{value:"AB+",children:"AB+"}),e.jsx("option",{value:"AB-",children:"AB-"}),e.jsx("option",{value:"O+",children:"O+"}),e.jsx("option",{value:"O-",children:"O-"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{type:"date",name:"date",value:a.date,onChange:l,className:"bg-black/30 rounded px-3 py-2 outline-none"}),e.jsx("input",{type:"time",name:"time",value:a.time,onChange:l,className:"bg-black/30 rounded px-3 py-2 outline-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("select",{name:"department",value:a.department,onChange:t=>{const s=t.target.value,n=m.filter(r=>r.department===s);c(r=>({...r,department:s,doctor:n.length>0?n[0]._id:""}))},className:"bg-black/30 rounded px-3 py-2 outline-none text-white",children:S.map(t=>e.jsx("option",{value:t,className:"bg-[var(--five)]",children:t},t))}),e.jsxs("select",{name:"doctor",value:a.doctor,onChange:l,className:"bg-black/30 rounded px-3 py-2 outline-none text-white",disabled:p().length===0,required:!0,children:[e.jsx("option",{value:"",children:"Select a doctor"}),p().map(t=>e.jsxs("option",{value:t._id,className:"bg-[var(--five)]",children:["Dr. ",t.fullName," ",t.speciality?`(${t.speciality})`:""]},t._id)),p().length===0&&e.jsx("option",{value:"",disabled:!0,children:"No doctors available in this department"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-1",children:"Medical Document (Optional)"}),e.jsx("input",{type:"file",name:"medicalDocument",value:a.medicalDocument,onChange:l,className:"w-full bg-[var(--five)] border border-gray-300 rounded px-3 py-2 text-gray-100 outline-none"})]}),y&&e.jsx("div",{className:"text-red-400 text-sm",children:y}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:C,className:"px-3 py-1 rounded bg-white/10",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:b||g,className:"px-3 py-1 rounded bg-green-400 text-black disabled:opacity-60",children:b||g?"Creating...":"Create"})]})]})};export{G as default};
